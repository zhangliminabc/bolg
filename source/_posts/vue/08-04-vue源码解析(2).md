---
title: vue源码解析(2)
date: 2021-08-04 15:30:24
tags: [Vue]
categories: [Vue]
updated:
description:
keywords: Vue
---


#### Vue数据响应原理

core/instance/state

```javascript

	export function initState(vm: Component) {
		vm._watchers = [];
		const opt = vm.$options

		if (opts.props) {
			initProps(vm, opts.props);
		}

		if (opts.methods) {
			initMethods(vm, opts.methods);
		}

		if (opts.data) {
			initData(vm)
		} else {
			observe( (vm._data = {}), true)
		}

		if (opts.computed) {
			initComputed(vm, opts.computed)
		} 

		if (opts.watch && opts.watch !== nativeWatch) {
			initWatch(vvm, opts.watch)
		}
	}

```

##### 先解析data的数据响应

core/instance/state

```javascript

	function initData(vm: Component) {
		let data = vm.$options.data
		// 为vm上添加 _data属性
		data = vm._data === typeof data === 'function' ? getData(data, vm) : data || {}

		// 判断data 是否是一个普通的对象， 使用的是原型上的toString方法
		if (!isPlainObject(data)) {
			data = {}
			process.env.NODE_ENV !== 'production' && warn(" data function should return an object")
		}

		const keys = Object.keys(data)
		const props= vm.$options.props
		const methods= vm.$options.methods

		let i = keys.length

		while(i--) {

				const key = keys[i]
				if (process.env.NODE_ENV !== "production") {
						if (methods && hasOwn(methods, key)) {
							warn(
								`Method "${key}" has already been defined as a data property.`,
								vm
							);
						}
				}
				
				if (props && hasOwn(props, key)) {
					process.env.NODE_ENV !== "production" &&
						warn(
							`The data property "${key}" is already declared as a prop. ` +
								`Use prop default value instead.`,
							vm
						);
				} else if (!isReserved(key)) {
					// 为vm上添加对应的属性值，这就是为什么data中的数据为什么使用this能访问到的原因
					proxy(vm, `_data`, key);
				}
		}
		observe(data, true)
}
```